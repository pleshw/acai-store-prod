class BagBuilder{static _items=[];static get items(){return BagBuilder._items}static set items(arrItems){this._items=arrItems;BagBuilder.resetBagComponent()}static addItem(item){BagBuilder._items.push(item);BagBuilder.resetBagComponent()}static resetBagComponent(){BagBuilder.resetBagInfoComponent();BagBuilder.resetBagPriceComponent()}static resetBagPriceComponent(){const elementBagTotalPrice=document.getElementById("bagTotalPrice");if(elementBagTotalPrice){elementBagTotalPrice.innerHTML=formatItemPrice(BagBuilder.totalPrice)}}static resetBagInfoComponent(){const elementOffcanvasBagInfo=document.getElementById("offcanvasBagInfo");if(elementOffcanvasBagInfo){elementOffcanvasBagInfo.innerHTML="";BagBuilder._items.forEach(i=>{elementOffcanvasBagInfo.insertAdjacentHTML("beforeend",templateItemOffcanvasBagInfo(i.id,i.details.name,i.amount,i.addons,i.price))})}}static get itemsDetails(){return BagBuilder.items.map(i=>i.item)}static get totalPrice(){if(!BagBuilder._items||BagBuilder._items.length<1){return 0}let arrAddonsPrices=BagBuilder.items.map(a=>a.price);return arrAddonsPrices.reduce((acc,next)=>acc+next,0)}static get addons(){if(!ItemBuilder.addons||ItemBuilder.addons.length<1){return 0}let arrAddonsPrices=ItemBuilder.items.map(a=>a.price);return arrAddonsPrices.reduce((acc,next)=>acc+next,0)}static reset(){ItemBuilder.items=[]}static buildAndReset(){const result=ItemBuilder.build();ItemBuilder.reset();return result}}function formatItemPrice(numItemPrice){return numItemPrice.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}).replaceAll(" ","")}function resetModalItemCount(){const spanAmountSelectedItem=document.getElementById("modalItemSelectAmount");if(spanAmountSelectedItem){spanAmountSelectedItem.innerHTML=ItemBuilder.amount}const buttonDecreaseItemCount=document.getElementById("decreaseItemCount");const buttonIncreaseItemCount=document.getElementById("increaseItemCount");if(!buttonIncreaseItemCount||!buttonDecreaseItemCount){return}if(ItemBuilder.amount===1){buttonDecreaseItemCount.setAttribute("disabled","")}else{buttonDecreaseItemCount.removeAttribute("disabled")}}function resetModalItemPrice(){const spanModalPrice=document.getElementById("modalItemSelectPrice");if(!spanModalPrice){return}if(ItemBuilder.details&&ItemBuilder.details.price){spanModalPrice.innerHTML=formatItemPrice(ItemBuilder.totalPrice)}}function addOrderDetailsForItem(itemName){const h1ModalTitle=document.getElementById("modalItemSelectTitle");const spanModalPrice=document.getElementById("modalItemSelectPrice");if(!modalItemSelectTitle||!spanModalPrice){return}ItemBuilder.details=dictItemsByName.get(itemName);h1ModalTitle.innerHTML=itemName+`<small class="fw-lighter user-select-none"><i>${ItemBuilder.details.freeAddons>1?` - Você pode selecionar até ${ItemBuilder.details.freeAddons} adicionais gratuitamente!</i></small>`:``}`;spanModalPrice.innerHTML=formatItemPrice(ItemBuilder.details.price)}class ItemBuilder{static details=null;static _amount=1;static addons=[];static{const buttonDecreaseItemCount=document.getElementById("decreaseItemCount");const buttonIncreaseItemCount=document.getElementById("increaseItemCount");buttonDecreaseItemCount.addEventListener("click",()=>ItemBuilder.amount--);buttonIncreaseItemCount.addEventListener("click",()=>ItemBuilder.amount++)}static get amount(){return ItemBuilder._amount}static set amount(val){if(val<1){return}ItemBuilder._amount=val;resetModalItemCount();resetModalItemPrice()}static get totalPrice(){if(!ItemBuilder.details&&!ItemBuilder.details.price){throw new Error("Item inválido. Tente recarregar o site.")}let currentItemPrice=ItemBuilder.details.price;currentItemPrice+=ItemBuilder.addonsPrice;return currentItemPrice*this._amount}static get addonsPrice(){if(!ItemBuilder.addons||ItemBuilder.addons.length<1){return 0}let arrAddonsPrices=ItemBuilder.addons.map(a=>a.price);if(ItemBuilder.details.freeAddons&&ItemBuilder.details.freeAddons>0){const arrCurrentAddonsPriceSorted=arrAddonsPrices.sort().reverse();arrCurrentAddonsPriceSorted.splice(0,ItemBuilder.details.freeAddons);arrAddonsPrices=arrCurrentAddonsPriceSorted}return arrAddonsPrices.reduce((acc,next)=>acc+next,0)}static get addonsPriceIncludeFreeAddons(){if(!ItemBuilder.addons||ItemBuilder.addons.length<1){return 0}let arrAddonsPrices=ItemBuilder.addons.map(a=>a.price);return arrAddonsPrices.reduce((acc,next)=>acc+next,0)}static reset(){ItemBuilder.amount=1;ItemBuilder.details=null;ItemBuilder.addons=[]}static build(){if(!ItemBuilder.details||ItemBuilder.amount<1){alert("Erro ao inserir item, por favor recarregue a página e tente novamente");throw new Error("Item inválido, por favor recarregue a página e tente novamente.")}const result={id:getItemUniqueId(),details:ItemBuilder.details,amount:ItemBuilder.amount,addons:ItemBuilder.addons,price:ItemBuilder.totalPrice,addonsPrice:ItemBuilder.addonsPrice,freeAddonsPrice:ItemBuilder.addonsPriceIncludeFreeAddons-ItemBuilder.addonsPrice};return result}static buildAndReset(){const result=ItemBuilder.build();ItemBuilder.reset();return result}}function getItemUniqueId(){const randomNumber=Math.random().toString(36).slice(2,11);const timestamp=(new Date).getTime();return`${randomNumber}-${timestamp}`}const defaultItemImage="https://flordejambu.com/wp-content/uploads/2022/05/acai.png";const dictItemsByName=new Map([["300ml",{name:"300ml",img:"https://flordejambu.com/wp-content/uploads/2022/05/acai.png",description:"Copo de 300ml com 3 adicionais grátis",price:11,freeAddons:3}],["400ml",{name:"400ml",img:"https://flordejambu.com/wp-content/uploads/2022/05/acai.png",description:"Copo de 400ml com 3 adicionais grátis",price:15,freeAddons:3}],["500ml",{name:"500ml",img:"https://flordejambu.com/wp-content/uploads/2022/05/acai.png",description:"Copo de 500ml com 4 adicionais grátis",price:20,freeAddons:4}],["700ml",{name:"700ml",img:"https://flordejambu.com/wp-content/uploads/2022/05/acai.png",description:"Copo de 700ml com 4 adicionais grátis",price:26,freeAddons:4}]]);const dictAddonsByName=new Map([["Leite em pó",{name:"Leite em pó",section:"Extras",price:.5}],["Amendoim",{name:"Amendoim",section:"Extras",price:.5}],["Amendoim triturado",{name:"Amendoim triturado",section:"Extras",price:.5}],["Paçoca",{name:"Paçoca",section:"Extras",price:.5}],["Granola",{name:"Granola",section:"Extras",price:.5}],["Choco ball",{name:"Choco ball",section:"Extras",price:.5}],["Choco power",{name:"Choco power",section:"Extras",price:.5}],["Disquete",{name:"Disquete",section:"Extras",price:.5}],["Farinha láctea",{name:"Farinha láctea",section:"Extras",price:.5}],["Marshmallow",{name:"Marshmallow",section:"Extras",price:.5}],["Ovomaltine",{name:"Ovomaltine",section:"Extras",price:.5}],["Jujubas",{name:"Jujubas",section:"Extras",price:.5}],["Gotas de Chocolate",{name:"Gotas de Chocolate",section:"Extras",price:.5}],["Castanha",{name:"Castanha",section:"Extras",price:.5}],["Chocolate",{name:"Chocolate",section:"Coberturas",price:.5}],["Morango",{name:"Morango",section:"Coberturas",price:.5}],["Kiwi",{name:"Kiwi",section:"Coberturas",price:.5}],["Leite condensado",{name:"Leite condensado",section:"Coberturas",price:.5}],["Creme de ninho",{name:"Creme de ninho",section:"Coberturas",price:.5}],["Pasta de avelã",{name:"Pasta de avelã",section:"Coberturas",price:.5}],["Banana",{name:"Banana",section:"Frutas",price:.5}],["Morango",{name:"Morango",section:"Frutas",price:.5}],["Cereja",{name:"Cereja",section:"Frutas",price:.5}],["Kiwi",{name:"Kiwi",section:"Frutas",price:.5}]]);function templateItemCountRegulator(elementId,hasBorders=true){return`
    <div style="width: 90px !important; max-width: 90px !important; box-sizing: border-box;"
      class="modal-button row p-0 m-0 user-select-none ${hasBorders?"border":""} justify-content-center align-items-center">
      <button style="transform: scale(.8)" id="itemCountRegulatorDecreaseItemCount${elementId}" type="button" tabindex="0"
        class="col-2 m-0 p-0 d-flex justify-content-center align-items-center btn border-0" aria-hidden="false"
        aria-label="Reduzir quantidade" disabled=""><span>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <path fill="#f00290" fill-rule="evenodd"
              d="M17.993 11c.556 0 1.007.444 1.007 1 0 .552-.45 1-1.007 1H6.007A1.001 1.001 0 0 1 5 12c0-.552.45-1 1.007-1h11.986z">
            </path>
          </svg>
        </span>
      </button>
      <span id="itemCountRegulatorCounter${elementId}" class="col-6 text-center user-select-none">0</span>
      <button style="transform: scale(.8)" id="itemCountRegulatorIncreaseItemCount${elementId}" type="button" tabindex="0"
        class="col-2 m-0 p-0 d-flex justify-content-center align-items-center btn border-0" aria-hidden="false"
        aria-label="Aumentar quantidade">
        <span>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <path fill="#f00290" fill-rule="evenodd"
              d="M13 11h4.993c.556 0 1.007.444 1.007 1 0 .552-.45 1-1.007 1H13v4.993C13 18.55 12.556 19 12 19c-.552 0-1-.45-1-1.007V13H6.007A1.001 1.001 0 0 1 5 12c0-.552.45-1 1.007-1H11V6.007C11 5.45 11.444 5 12 5c.552 0 1 .45 1 1.007V11z">
            </path>
          </svg>
        </span>
      </button>
    </div>
  `}function resetButtonsItemCountRegulator(elementId,newValue,minValue=0,maxValue=10){const spanAmountSelectedItem=document.getElementById(`itemCountRegulatorCounter${elementId}`);if(spanAmountSelectedItem){spanAmountSelectedItem.innerHTML=newValue.toString()}const buttonDecreaseItemCount=document.getElementById(`itemCountRegulatorDecreaseItemCount${elementId}`);const buttonIncreaseItemCount=document.getElementById(`itemCountRegulatorIncreaseItemCount${elementId}`);if(!buttonIncreaseItemCount||!buttonDecreaseItemCount){return}if(newValue===minValue){buttonDecreaseItemCount.setAttribute("disabled","")}else{buttonDecreaseItemCount.removeAttribute("disabled")}if(newValue===maxValue){buttonIncreaseItemCount.setAttribute("disabled","")}else{buttonIncreaseItemCount.removeAttribute("disabled")}}function itemCountRegulatorSetListeners(elementId,minValue=0,maxValue=10){const buttonDecreaseItemCount=document.getElementById(`itemCountRegulatorDecreaseItemCount${elementId}`);const buttonIncreaseItemCount=document.getElementById(`itemCountRegulatorIncreaseItemCount${elementId}`);if(!buttonDecreaseItemCount||!buttonIncreaseItemCount){return}buttonDecreaseItemCount.addEventListener("click",()=>{const spanAmountSelectedItem=document.getElementById(`itemCountRegulatorCounter${elementId}`);let currentItemAmount=+spanAmountSelectedItem.innerHTML;currentItemAmount--;if(currentItemAmount<minValue){currentItemAmount=minValue}resetButtonsItemCountRegulator(elementId,currentItemAmount,minValue,maxValue);const addonIndex=ItemBuilder.addons.findIndex(a=>a.name===elementId);if(addonIndex===-1){return}ItemBuilder.addons.splice(addonIndex,1);resetModalItemPrice()});buttonIncreaseItemCount.addEventListener("click",()=>{const spanAmountSelectedItem=document.getElementById(`itemCountRegulatorCounter${elementId}`);let currentItemAmount=+spanAmountSelectedItem.innerHTML;currentItemAmount++;if(currentItemAmount>maxValue){currentItemAmount=maxValue}resetButtonsItemCountRegulator(elementId,currentItemAmount,minValue,maxValue);if(dictAddonsByName.has(elementId)){ItemBuilder.addons.push(dictAddonsByName.get(elementId));resetModalItemPrice()}})}function templateStoreItem(itemName,itemInfo){return`
  <div id="itemShowcase${itemName}" onclick="addOrderDetailsForItem('${itemName}')" class="item-showcase col-12 col-lg-3 col-xl-3 p-0 pointer mb-4 d-flex justify-content-center" data-bs-toggle="modal" data-bs-target="#modalItemSelect">
    <div class="col-12 col-lg-3 col-xl-3 m-0 p-0 pointer card acai-card shadow shadow-sm border border-2 border-top-0" style="width: 310px;">
      <img src="${itemInfo.img??defaultItemImage}" style="height: 270px;"
        class="card-img-top">
        <div class="card-body" style="height: 150px;">
          <h4 id="itemShowcaseName${itemName}" class="card-title item-showcase-name fw-bolder text-purple2">${itemName}</h4>
          <p id="itemShowcaseDescription${itemName}" class="card-text item-showcase-description text-muted">
            ${itemInfo.description}
          </p>
          <p class="card-text text-success" id="itemShowcasePrice${itemName}"><u><b><small>${formatItemPrice(itemInfo.price)}</small></b></u></p>
        </div>
        <div class="card-footer text-body-secondary">
          ${itemInfo.alert??"<small>Clique para escolher os acompanhamentos</small>"}
        </div>
    </div>
  </div>
  `}function templateStoreAddonSection(sectionName){return`
    <section id="modalItemSelectAddonsSection${sectionName}">
      <h5 class="bg-body-secondary text-purple p-3 shadow-sm border-bottom m-0">${sectionName}</h5>

      <ul  class="list-group list-group-flush" id="modalItemSelectAddonsSectionItems${sectionName}">
      </ul>
    </section>
  `}function templateAddon(itemName){if(!dictAddonsByName.has(itemName)){return""}return`
      <li class="list-group-item py-4 px-2 d-flex justify-content-between align-items-center" id="modalItemSelectAddonsItem${itemName}">
        <span class="position-relative d-flex align-items-center">
            <span class="addon-price badge rounded-0 bg-success p-1 border shadow">${formatItemPrice(dictAddonsByName.get(itemName).price)}</span>
            <div class="vr mx-2 p-0"></div>
            ${itemName}
          </span>
        <span>${templateItemCountRegulator(itemName,false)}</span>
      </li>
  `}function getDictCountByAddon(arrAddons){const dict=new Map;arrAddons.forEach(item=>{if(dict.has(item.name)){dict.set(item.name,dict.get(item.name)+1)}else{dict.set(item.name,1)}});return dict}function formatDictCountByAddon(amountByAddon){return[...amountByAddon.entries()].reduce((accumulator,[itemName,itemCount],index,array)=>{const comma=index<array.length-1?", ":"";return accumulator+`${itemCount}x ${itemName}${comma}`},"")}function templateItemOffcanvasBagInfo(itemId,itemName,itemAmount,itemAddons,itemTotalPrice){const amountByAddon=getDictCountByAddon(itemAddons);let strItemAddons="";if(itemAddons&&itemAddons.length>0){strItemAddons=formatDictCountByAddon(amountByAddon)}else{strItemAddons="Sem adicionais."}return`        
    <li id="bagInfoItem${itemId}" class="list-group-item">
      <div class="card border-0">
        <div class="card-body">
          <h6 class="card-title fw-bold text-body-secondary row justify-content-between">
            <span class="col-6 text-start m-0 p-0"><small><b><i id="bagInfoItemAmount${itemId}">${itemAmount}</i>x</b></small id="bagInfoItemName${itemId}"> ${itemName}</span>

            <span class="col-5 text-end"><small id="bagInfoItemPrice${itemId}">${formatItemPrice(itemTotalPrice)}</small></span>
          </h6>
          <span id="bagInfoItemAddons${itemId}" class="card-subtitle mb-2 text-body-tertiary">${strItemAddons}</span>

          <div class="card-footer bg-transparent border-0 d-flex justify-content-start px-0 gap-5">
            <button type="button" class="btn border-0 fw-bold text-pink px-0">Editar</button>

            <button type="button" class="btn border-0 fw-bold text-body-tertiary px-0">
              <small>Remover</small>
            </button>
          </div>
        </div>
      </div>
    </li>`}function setHTMLProducts(){const divCoposSection1=document.getElementById("coposCustomizaveis");if(!divCoposSection1){return}dictItemsByName.forEach((val,key)=>divCoposSection1.insertAdjacentHTML("beforeend",templateStoreItem(key,val)))}function setHTMLAddonsSections(){const divAddonsSections=document.getElementById("modalItemSelectAddons");if(!divAddonsSections){return}dictAddonsByName.forEach((val,key)=>{const divCurrentAddonSection=document.getElementById(`modalItemSelectAddonsSection${val.section}`);if(!divCurrentAddonSection){divAddonsSections.insertAdjacentHTML("beforeend",templateStoreAddonSection(val.section))}const divAddonsContainer=document.getElementById(`modalItemSelectAddonsSectionItems${val.section}`);divAddonsContainer.insertAdjacentHTML("beforeend",templateAddon(key));itemCountRegulatorSetListeners(key,0,10)})}function initStore(){setHTMLProducts();setHTMLAddonsSections()}function addCurrentItem(){BagBuilder.addItem(ItemBuilder.buildAndReset())}function makeInputSearchShowcase(inputId){const inputElement=document.getElementById(inputId);if(!inputElement){throw new Error("Invalid input element.")}inputElement.addEventListener("input",function(){var searchTerm=this.value.trim().toLowerCase().replaceAll(" ","");var arrElementItemShowCase=Array.from(document.querySelectorAll(".item-showcase"));arrElementItemShowCase.forEach(function(itemCardElement){const titleContainsSearchTerm=itemCardElement.querySelector(".item-showcase-name").innerHTML.toLowerCase().replaceAll(" ","").includes(searchTerm);const descriptionContainsSearchTerm=itemCardElement.querySelector(".item-showcase-description").innerHTML.toLowerCase().replaceAll(" ","").includes(searchTerm);if(titleContainsSearchTerm||descriptionContainsSearchTerm){itemCardElement.classList.remove("d-none")}else{itemCardElement.classList.add("d-none")}})});inputElement.addEventListener("input",function(event){if(event.inputType==="deleteContentBackward"||event.inputType==="deleteContentForward"){if(this.value.trim()===""){var elementos=document.querySelectorAll("#elementos > div");elementos.forEach(function(elemento){elemento.classList.remove("d-none")})}}})}window.addEventListener("load",()=>{const modalItemSelect=document.getElementById("modalItemSelect");modalItemSelect.addEventListener("hidden.bs.modal",()=>{ItemBuilder.reset();dictAddonsByName.forEach((_val,key)=>{resetButtonsItemCountRegulator(key,0)})});makeInputSearchShowcase("inputBuscaDesktop");makeInputSearchShowcase("inputBuscaMobile")});